Тестовое задание
Выполнить разбор файла почтового лога, залить данные в БД и организовать поиск по адресу получателя.
Исходные данные:
1. Файл лога maillog
2. Схема таблиц в БД (допускается использовать postgresql или mysql):
CREATE TABLE message (
created TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL,
id VARCHAR NOT NULL,
int_id CHAR(16) NOT NULL,
str VARCHAR NOT NULL,
status BOOL,
CONSTRAINT message_id_pk PRIMARY KEY(id)
);
CREATE INDEX message_created_idx ON message (created);
CREATE INDEX message_int_id_idx ON message (int_id);
CREATE TABLE log (
created TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL,
int_id CHAR(16) NOT NULL,
str VARCHAR,
address VARCHAR
);
CREATE INDEX log_address_idx ON log USING hash (address);
Пояснения:
В качестве разделителя в файле лога используется символ пробела.
Значения первых полей:
дата
время
внутренний id сообщения
флаг
адрес получателя (либо отправителя)
другая информация
В качестве флагов используются следующие обозначения:
<= прибытие сообщения (в этом случае за флагом следует адрес отправителя)
=> нормальная доставка сообщения
-> дополнительный адрес в той же доставке
** доставка не удалась
== доставка задержана (временная проблема)
В случаях, когда в лог пишется общая информация, флаг и адрес получателя не указываются.
Задачи:
1. Выполнить разбор предлагаемого файла лога с заполнением таблиц БД:
В таблицу message должны попасть только строки прибытия сообщения (с флагом <=). Поля таблицы
должны содержать следующую информацию:
created - timestamp строки лога
id - значение поля id=xxxx из строки лога
int_id - внутренний id сообщения
str - строка лога (без временной метки)
В таблицу log записываются все остальные строки:
created - timestamp строки лога
int_id - внутренний id сообщения
str - строка лога (без временной метки)
address - адрес получателя
2. Создать html-страницу с поисковой формой, содержащей одно поле (type="text") для ввода адреса получателя.
Результатом отправки формы должен являться список найденных записей '<timestamp> <строка лога>' из двух
таблиц, отсортированных по идентификаторам сообщений (int_id) и времени их появления в логе.
Отображаемый результат необходимо ограничить сотней записей, если количество найденных строк превышает
указанный лимит, должно выдаваться соответствующее сообщение.